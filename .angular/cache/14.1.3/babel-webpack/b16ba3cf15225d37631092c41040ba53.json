{"ast":null,"code":"import { assign, cloneDeep } from 'lodash-es';\nimport { FuseMockApiUtils } from '@fuse/lib/mock-api/mock-api.utils';\nimport { tags as tagsData, tasks as tasksData } from 'app/mock-api/apps/tasks/data';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@fuse/lib/mock-api/mock-api.service\";\nexport let TasksMockApi = /*#__PURE__*/(() => {\n  class TasksMockApi {\n    /**\n     * Constructor\n     */\n    constructor(_fuseMockApiService) {\n      this._fuseMockApiService = _fuseMockApiService;\n      this._tags = tagsData;\n      this._tasks = tasksData; // Register Mock API handlers\n\n      this.registerHandlers();\n    } // -----------------------------------------------------------------------------------------------------\n    // @ Public methods\n    // -----------------------------------------------------------------------------------------------------\n\n    /**\n     * Register Mock API handlers\n     */\n\n\n    registerHandlers() {\n      // -----------------------------------------------------------------------------------------------------\n      // @ Tags - GET\n      // -----------------------------------------------------------------------------------------------------\n      this._fuseMockApiService.onGet('api/apps/tasks/tags').reply(() => [200, cloneDeep(this._tags)]); // -----------------------------------------------------------------------------------------------------\n      // @ Tags - POST\n      // -----------------------------------------------------------------------------------------------------\n\n\n      this._fuseMockApiService.onPost('api/apps/tasks/tag').reply(({\n        request\n      }) => {\n        // Get the tag\n        const newTag = cloneDeep(request.body.tag); // Generate a new GUID\n\n        newTag.id = FuseMockApiUtils.guid(); // Unshift the new tag\n\n        this._tags.unshift(newTag);\n\n        return [200, newTag];\n      }); // -----------------------------------------------------------------------------------------------------\n      // @ Tags - PATCH\n      // -----------------------------------------------------------------------------------------------------\n\n\n      this._fuseMockApiService.onPatch('api/apps/tasks/tag').reply(({\n        request\n      }) => {\n        // Get the id and tag\n        const id = request.body.id;\n        const tag = cloneDeep(request.body.tag); // Prepare the updated tag\n\n        let updatedTag = null; // Find the tag and update it\n\n        this._tags.forEach((item, index, tags) => {\n          if (item.id === id) {\n            // Update the tag\n            tags[index] = assign({}, tags[index], tag); // Store the updated tag\n\n            updatedTag = tags[index];\n          }\n        });\n\n        return [200, updatedTag];\n      }); // -----------------------------------------------------------------------------------------------------\n      // @ Tag - DELETE\n      // -----------------------------------------------------------------------------------------------------\n\n\n      this._fuseMockApiService.onDelete('api/apps/tasks/tag').reply(({\n        request\n      }) => {\n        // Get the id\n        const id = request.params.get('id'); // Find the tag and delete it\n\n        const index = this._tags.findIndex(item => item.id === id);\n\n        this._tags.splice(index, 1); // Get the tasks that have the tag\n\n\n        const tasksWithTag = this._tasks.filter(task => task.tags.indexOf(id) > -1); // Iterate through them and remove the tag\n\n\n        tasksWithTag.forEach(task => {\n          task.tags.splice(task.tags.indexOf(id), 1);\n        });\n        return [200, true];\n      }); // -----------------------------------------------------------------------------------------------------\n      // @ Tasks - GET\n      // -----------------------------------------------------------------------------------------------------\n\n\n      this._fuseMockApiService.onGet('api/apps/tasks/all').reply(() => {\n        // Clone the tasks\n        const tasks = cloneDeep(this._tasks); // Sort the tasks by order\n\n        tasks.sort((a, b) => a.order - b.order);\n        return [200, tasks];\n      }); // -----------------------------------------------------------------------------------------------------\n      // @ Tasks Search - GET\n      // -----------------------------------------------------------------------------------------------------\n\n\n      this._fuseMockApiService.onGet('api/apps/tasks/search').reply(({\n        request\n      }) => {\n        // Get the search query\n        const query = request.params.get('query'); // Prepare the search results\n\n        let results; // If the query exists...\n\n        if (query) {\n          // Clone the tasks\n          let tasks = cloneDeep(this._tasks); // Filter the tasks\n\n          tasks = tasks.filter(task => task.title && task.title.toLowerCase().includes(query.toLowerCase()) || task.notes && task.notes.toLowerCase().includes(query.toLowerCase())); // Mark the found chars\n\n          tasks.forEach(task => {\n            const re = new RegExp('(' + query.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&') + ')', 'ig');\n            task.title = task.title.replace(re, '<mark>$1</mark>');\n          }); // Set them as the search result\n\n          results = tasks;\n        } // Otherwise, set the results to null\n        else {\n          results = null;\n        }\n\n        return [200, results];\n      }); // -----------------------------------------------------------------------------------------------------\n      // @ Tasks Orders - PATCH\n      // -----------------------------------------------------------------------------------------------------\n\n\n      this._fuseMockApiService.onPatch('api/apps/tasks/order').reply(({\n        request\n      }) => {\n        // Get the tasks\n        const tasks = request.body.tasks; // Go through the tasks\n\n        this._tasks.forEach(task => {\n          // Find this task's index within the tasks array that comes with the request\n          // and assign that index as the new order number for the task\n          task.order = tasks.findIndex(item => item.id === task.id);\n        }); // Clone the tasks\n\n\n        const updatedTasks = cloneDeep(this._tasks);\n        return [200, updatedTasks];\n      }); // -----------------------------------------------------------------------------------------------------\n      // @ Task - GET\n      // -----------------------------------------------------------------------------------------------------\n\n\n      this._fuseMockApiService.onGet('api/apps/tasks/task').reply(({\n        request\n      }) => {\n        // Get the id from the params\n        const id = request.params.get('id'); // Clone the tasks\n\n        const tasks = cloneDeep(this._tasks); // Find the task\n\n        const task = tasks.find(item => item.id === id);\n        return [200, task];\n      }); // -----------------------------------------------------------------------------------------------------\n      // @ Task - POST\n      // -----------------------------------------------------------------------------------------------------\n\n\n      this._fuseMockApiService.onPost('api/apps/tasks/task').reply(({\n        request\n      }) => {\n        // Generate a new task\n        const newTask = {\n          id: FuseMockApiUtils.guid(),\n          type: request.body.type,\n          title: '',\n          notes: null,\n          completed: false,\n          dueDate: null,\n          priority: 1,\n          tags: [],\n          order: 0\n        }; // Unshift the new task\n\n        this._tasks.unshift(newTask); // Go through the tasks and update their order numbers\n\n\n        this._tasks.forEach((task, index) => {\n          task.order = index;\n        });\n\n        return [200, newTask];\n      }); // -----------------------------------------------------------------------------------------------------\n      // @ Task - PATCH\n      // -----------------------------------------------------------------------------------------------------\n\n\n      this._fuseMockApiService.onPatch('api/apps/tasks/task').reply(({\n        request\n      }) => {\n        // Get the id and task\n        const id = request.body.id;\n        const task = cloneDeep(request.body.task); // Prepare the updated task\n\n        let updatedTask = null; // Find the task and update it\n\n        this._tasks.forEach((item, index, tasks) => {\n          if (item.id === id) {\n            // Update the task\n            tasks[index] = assign({}, tasks[index], task); // Store the updated task\n\n            updatedTask = tasks[index];\n          }\n        });\n\n        return [200, updatedTask];\n      }); // -----------------------------------------------------------------------------------------------------\n      // @ Task - DELETE\n      // -----------------------------------------------------------------------------------------------------\n\n\n      this._fuseMockApiService.onDelete('api/apps/tasks/task').reply(({\n        request\n      }) => {\n        // Get the id\n        const id = request.params.get('id'); // Find the task and delete it\n\n        const index = this._tasks.findIndex(item => item.id === id);\n\n        this._tasks.splice(index, 1);\n\n        return [200, true];\n      });\n    }\n\n  }\n\n  TasksMockApi.ɵfac = function TasksMockApi_Factory(t) {\n    return new (t || TasksMockApi)(i0.ɵɵinject(i1.FuseMockApiService));\n  };\n\n  TasksMockApi.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: TasksMockApi,\n    factory: TasksMockApi.ɵfac,\n    providedIn: 'root'\n  });\n  return TasksMockApi;\n})();","map":null,"metadata":{},"sourceType":"module"}